"0","library(tidyverse)"
"0","library(glue)"
"0","# stacked bar chart / put (n) in parenthesis for encounters, sort thusly"
"0","Magnus_results <- matches_df %>% filter(hero_name == ""Magnus Carlsen"") %>% "
"0","  group_by(opponent_name) %>% "
"0","  count(result) %>% "
"0","  add_count(wt = n) %>% "
"0","#  filter(nn > 5) %>% "
"0","  mutate(pct = n / nn) %>% "
"0","  mutate(name_N = glue('{opponent_name} ({nn})'))"
"0","  "
"0","Magnus_results$result <- factor(Magnus_results$result, levels = c(""win"", ""draw"", ""lose""))  "
"0","  "
"0","top12 <- Magnus_results %>% select(opponent_name, nn) %>% distinct() %>% arrange(desc(nn)) %>% head(12) %>% pull(opponent_name)"
"0",""
"0","Magnus_results %>% filter(opponent_name %in% top12) %>% "
"0","  ggplot(aes(y = fct_reorder(name_N, nn), x = pct, "
"0","             label = pct, fill = result)) +"
"0","  geom_col(position = ""stack"") +  "
"0","  scale_x_continuous(labels = scales::percent, expand = c(0, 0)) +"
"0","  geom_text(aes(label = paste0(round(pct*100, 1),""%"")), "
"0","            position = position_stack(vjust = 0.5), "
"0","            size = 3, color = ""white"") +"
"0","  theme_light() +"
"0","  scale_fill_manual(values = c(""#00BA38"", ""#619CFF"", ""#F8766D"")) +"
"0","  labs(x = """", y = """", fill = ""Result:"", subtitle = ""Magnus Carlsens most common encounters in 2023\nTitled Tuesday Tournaments"") "
